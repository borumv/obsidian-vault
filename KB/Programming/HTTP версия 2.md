---
created: Monday 13th March 2023 09:08
Last modified: Monday 13th March 2023 09:08
Aliases: http/2
Tags: programming
---

Главные отличия HTTP/2 от HTTP/1:
- Бинарный вместо текстового
Бинарные сообщения быстрее разбираются автоматически, представляя из себя **Frames** и **Streams**.
Но, в отличии *от текстового* - не понятны для чтения человеком.
Переходом на бинарный код протокол HTTP/2 пытается решить **проблему задержки** (latency)
![[Pasted image 20230312133917.png]]
Теперь *все HTTP-сообщения* делятся на фреймы  (*HEADERS, DATA, RST_STRIME, PUSH_PROMISE, PRIORITY, etc*)
![[Pasted image 20230312134147.png]]
т.е. в отличии от http/1 сейчас происходит разбиения не на **логические** части, а **физические(*фреймы*)**.
Коллекция таких фреймов - это двунаправленный *поток (Stream)*. Следовательно, каждый фрейм содержит индентификатор (id) *потока*
Каждый клиентский запрос использует *нечётный Id*, а ответ от сервера - чётные
![[Pasted image 20230312203222.png]]

- [[Мультиплексирование]] (несколько асинхронных запросов через одно [[TCP протокол|TCP]] соединение) 
Благодаря **бинарному протоколу** и представлению данных в виде *фреймов* и *потоков*, клиент и сервер могут обмениваться данными *асинхронно*, используя лишь **одно [[TCP протокол|tcp]] соединение**.
Это также решило проблему *блокировки* запросов. Когда медленный или большой запрос блокировал все последующие

- Server push (несколько ответов на один запрос)
Сервер, зная, что клиент *может запросить* определённые ресурс, может *отправть его сам*, не дожидаясь запроса.
>Для этого сервер отправляет специальный *фрейм* PUSH_PROMISE, c таким же id, что и запрос клиента
![[Pasted image 20230312203928.png]]
- Сжатие заголовков методом [[HPACK]]
Состоит из трёх основных частей:
1. **Статическая таблица** - общая для всех [[TCP протокол|tcp]] соединений и содержит часто используемые заголовки, которые можно найти в документации протокола
2. **Динамическая таблица** - создаётся *для каждого* TCP соединения и содержит 61 используемые заголовки во время обмена сообщениями (огранчиения размера)
3. Сжатие заголовков [[Алгоритм Хаффмана|алгоритмом Хаффмана]]
![[Pasted image 20230312204533.png|300]]

- Приоритезация запросов
Клиент может нпазначить приоритет **потоку**, добавив соотвествующую информацию во фрейме HEADERS (число от **1 до 256**), либо обновить уже созданный поток с помощью фрейма PRIORITY
>Также, каждому потоку может быть дана явная зависимость от другого потока, что вместе с приоритетами представляет собой "дерево приоритетов"
>![[Pasted image 20230312204945.png|144]]

- Безопасность
	Большинство клиентов (браузеров) поддерживают HTTP/2 только если он используется поверх протокола [[TLS]] (т.е. должен использоваться протокол [[HTTPS]])
	В свою очередь, спецификация не требует данного ограничения
	Сокращение числа подключений ввиду перечисленных преимуществ HTTP/2 приводит к сокращению затратных "рукопожатий TLS" (TLS handshake)

